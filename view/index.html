<html>
<head>
    <title>Data Science for Good: CareerVillage.org | Kaggle Demo</title>
    <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.4.0.min.js" integrity="sha256-BJeo0qm959uMBGb65z40ejJYGSgR7REI4+CW1fNKwOg=" crossorigin="anonymous"></script>
   

    <style type="text/css">
        * {
            font-size: 16px;
            font-family: 'Montserrat', sans-serif;
        }

        .show {
            display: block;
        }

        .hide {
            display: none !important;
        }

        .tab {
            padding: 8px 16px;
            cursor: pointer;
            width: 256px;
            font-size: 18px;
            text-align: center;
            font-weight: bold;
        }

        .tab_active {
            border-bottom: 2px solid black;
        }

        .disabledTab{
            pointer-events: none;
            padding: 8px 16px;
            cursor: pointer;
            width: 256px;
            font-size: 18px;
            text-align: center;
            font-weight: bold;
        }

        .content {
            padding: 32px;
            margin-top: 8px;
            border: 1px solid black;
        }

        table, tr {
            font-size: 12px !important;
        }

        tr:nth-child(even) {
            background-color: #f2f2f2
        }

        th, td {
            padding: 4px 12px;
            font-size: inherit;
        }

        select, input, textarea {
            width: 100%;
        }

        label {
            display: block;
            margin-bottom: 8px;
        }
        #progress-wrp {
  border: 1px solid #0099CC;
  padding: 1px;
  position: relative;
  height: 30px;
  border-radius: 3px;
  margin: 10px;
  text-align: left;
  background: #fff;
  box-shadow: inset 1px 3px 6px rgba(0, 0, 0, 0.12);
}

#progress-wrp .progress-bar {
  height: 100%;
  border-radius: 3px;
  background-color: #f39ac7;
  width: 0;
  box-shadow: inset 1px 1px 10px rgba(0, 0, 0, 0.11);
}

#progress-wrp .status {
  top: 3px;
  left: 50%;
  position: absolute;
  display: inline-block;
  color: #000000;
}
    </style>
</head>

<body style="margin: 32px;">
<h2 style="font-size: 24px;">Kaggle Demo</h2>
<h3 style="font-size: 20px;"><a href="https://www.kaggle.com/c/data-science-for-good-careervillage">Data Science for Good: CareerVillage.org</a></h3>
<h4 style="font-size: 18px;">Live Demo with NN based fast similarity search</h3>
<h5 style="font-size: 14px;">Proposed method takes into account all the possible content features using custom Neural Network Architecture. <br> Allows automatically find a probability mapping between question and professional entities in all of the combinations (que-que, que-pro, pro-que, pro-pro)</h4>

<div style="display: flex;">
    <div id="file_tab" class="tab tab_active">
        By file
    </div>
    <div id="form_tab" class="tab" >
        By form
    </div>
</div>
<div id="file_content" class="content show">
    <div style="margin-bottom: 20px;"><b>Find out if your email is spam bu submitting </b></div>
    <div style="display: flex;">
        <form id="file_form" style="display: block; min-width: 320px;">
            <label>Email file <b style="color: red;">*</b></label>
            
            <input name="email_file" style="display: block" type='file' id='email_file' />               
            <div id="progress-wrp">
                <div class="progress-bar"></div>
                <div class="status">0%</div>
            </div>
            <br>
            
            <!--<button type="submit">Submit</button>-->
            <button type="reset">Clear</button>
        </form>

        <div style="display: block; margin-left: 32px;">
            <div id="file_empty" style="display: flex; align-items: center; justify-content: center; width: 320px;"
                 class="show">
                Please, fill form and submit it
            </div>

            <div id="answer_file" style="display: block; word-break: break-all;" class="hide">
                <p></p>
            </div>
        </div>
    </div>
</div>
<div id="professionals_content" class="content hide">
    <div style="margin-bottom: 20px;"><b>Finds relevant questions for professional to answer</b></div>
    <div style="display: flex;">
        <form id="professionals_form" style="display: block; min-width: 320px;">
            <label>Professional Selector <b style="color: red;">*</b></label>
            <select name="professionals_id" style="display: block">
                <option value="f783d3387a60435ea6f2444fb62325dc">Id: f783d3387a60435ea6f2444fb62325dc, location: Lancaster, England, United Kingdom; <br>industry: Environmental Services; headline: Researcher at Lancaster University</option>
                <option value="76ebb07543af458f8c3a9a502286f4ef">Id: 76ebb07543af458f8c3a9a502286f4ef; location: North Carolina, North Carolina; industry: Real Estate; headline: Regional Vice President - PRG Real Estate Manager</option>
                <option value="350a7fe2bdf34216b1496ac13a00649e">Id: 350a7fe2bdf34216b1496ac13a00649e; location: Jacksonville, Florida; industry: Computer Games; headline: Senior Software Engineer at Zynga Sports 365</option>
                <option value="cebebfc280f14eb69a9cb8eb939822f7">Id: cebebfc280f14eb69a9cb8eb939822f7; location: Chennai, Tamil Nadu, India; industry: Mechanical or Industrial Engineering; headline: mechanical engineer</option>
                <option value="8cb2676d389f4317a20709eb8426c2c2">Id: 8cb2676d389f4317a20709eb8426c2c2; location: Oakland, California; industry: Security and Investigations; headline: Federal Protective Security</option>
                <option value="6c7b20179cde493a8e6be5c93f8b3535">Id: 6c7b20179cde493a8e6be5c93f8b3535; location: Dallas, Texas; industry: Animation; headline: Visual Effects & Animation</option>
                <option value="4fc7f10cc9094109a24f83d7c2ad932f">Id: 4fc7f10cc9094109a24f83d7c2ad932f; location: Egypt; industry: Chemicals; headline: chemical engineer</option>
                <option value="04edc40ea7c240a8bfaaa19394e1f47a">Id: 04edc40ea7c240a8bfaaa19394e1f47a; location: Langhorne, Pennsylvania; industry: Mental Health Care; headline: Quality Assurance Coordinator at New Jersey</option>
                <option value="d922b841ceb545d7b5ce7bb066ef96ec">Id: d922b841ceb545d7b5ce7bb066ef96ec; location: Coppell, Texas; industry: Computer and Tabletop Games; headline: Game Designer and Educator</option>
                <option value="34e6995ff9cc41ac853af7da4c15cfce">Id: 34e6995ff9cc41ac853af7da4c15cfce; location: San Antonio, Texas; industry: Airlines/Aviation; headline: Proprietor at Julicher Aviation</option>
                <option value="5ca6a4d5d6d047e0a264a7c540e7fee2">Id: 5ca6a4d5d6d047e0a264a7c540e7fee2; location: Chicago, Illinois; industry: Music; headline: Audio Engineer | Music Producer</option>
                <option value="e2881beb96334dcba8fa3c7feeafe928">Id: e2881beb96334dcba8fa3c7feeafe928; location: New York, New York; industry: Mechanical or Industrial Engineering; headline: Co Owner at SB Royal</option>
                <option value="873a4b08d4434f088a4d1f4b9654af4d">Id: 873a4b08d4434f088a4d1f4b9654af4d; location: Humble, Texas; industry: Information Technology and Services; headline: IT Support Extraordinaire</option>
                <option value="1db1485cc8c74b0291505e92237b98d0">Id: 1db1485cc8c74b0291505e92237b98d0; location: New York, New York; industry: Hospital and Health Care; headline: Physical Therapist</option>
                <option value="bf61b9f8b7b3476880011855411f529d">Id: bf61b9f8b7b3476880011855411f529d; location: Los Angeles, California; industry: Broadcast Media; headline: Producer at The Upright Citizens Brigade Theatre</option>
                <option value="8e4c7a994e4e41a8869c58c7d22a6ae6">Id: 8e4c7a994e4e41a8869c58c7d22a6ae6; industry: Telecommunications</option>
                <option value="b0d3d3269786402c9904338d5494492a">Id: b0d3d3269786402c9904338d5494492a; location: California, California; industry: Computer Software; headline: Actively Seeking Full Time Opportunities</option>
                <option value="180a00a269c7476095938fa1d59f9b34">Id: 180a00a269c7476095938fa1d59f9b34; location: Greece; industry: Education Management; headline: teacher</option>
                <option value="6d5c91cdb89c4bb3987d9524b1369179">Id: 6d5c91cdb89c4bb3987d9524b1369179; location: Herndon, Virginia  ; industry: Public Relations; headline: Senior Communications Specialist</option>
                <option value="26d8ea280c7b451798968fb6b5ebb83a">Id: 26d8ea280c7b451798968fb6b5ebb83a; location: Santa Cruz, California; industry: Research; headline: Wildlife Ecologist</option>
                <option value="012de91c57f741d49f9feb67bb242b7d">Id: 012de91c57f741d49f9feb67bb242b7d; location: Greater Pittsburgh Area; industry: Writing and Editing; headline: Creative Writer~Copy, Content, Poetry, Word</option>
                <option value="1cf674f780184abbbafba79a7d38ca36">Id: 1cf674f780184abbbafba79a7d38ca36; location: Ithaca, New York Area; industry: Higher Education; headline: Graduate Research Assistant at Binghamton University</option>
                <option value="176d5aeeef1546cd962fb2375eeec7c5">Id: 176d5aeeef1546cd962fb2375eeec7c5; location: Phoenix, Arizona Area; industry: Financial Services; headline: Trust Officer at FineMark Bank</option>
                <option value="5c2242b9b4bf4e48982823f454fbd00d">Id: 5c2242b9b4bf4e48982823f454fbd00d; location: Westbury, New York; industry: Medical Practice; headline: Orthodontics at All About Smiles Dentistry,PLLC</option>
                <option value="9eab96bba1ad4c9fa241e0ab2916e4f6">Id: 9eab96bba1ad4c9fa241e0ab2916e4f6; location: Kitchener, Canada Area; industry: Accounting; headline: Senior Associate, Assurance at PwC</option>
                <option value="93cc0b14523b4f69bd3b2e44bef36d30">Id: 93cc0b14523b4f69bd3b2e44bef36d30; location: San Jose, California; industry: Banking; headline: Manager, Product Communications & Training  </option>
                <option value="1ad13abd75b641198468b121e83e8706">Id: 1ad13abd75b641198468b121e83e8706; location: San Francisco Bay Area; industry: Design; headline: Graphic Designer based in San Francisco</option>
                <option value="db993ff4b1204dd08349944e2ca2ad2a">Id: db993ff4b1204dd08349944e2ca2ad2a; location: Tampa/St. Petersburg, Florida Area; industry: Oil and Energy; headline: Technical Superintendent at Pacific Drilling</option>
                <option value="5decbeed59da48479805466a45c0c41e">Id: 5decbeed59da48479805466a45c0c41e; location: Greater New York City Area; industry: Biotechnology; headline: Graduate from Stony Brook University</option>
                <option value="c946d53a8efe48dca1f6cc2360bbfa36">Id: c946d53a8efe48dca1f6cc2360bbfa36; location: San Francisco Bay Area; industry: International Trade and Development; headline: International Business Professional</option>

            </select>
            <br>

            <button type="submit">Submit</button>
            <button type="reset">Clear</button>
        </form>

        <div style="display: block; margin-left: 32px;">
            <div id="professionals_empty"
                 style="display: flex; align-items: center; justify-content: center; width: 320px;"
                 class="show">
                Please, fill form and submit it
            </div>

            <table id="professionals_table" style="display: block; word-break: break-all;" class="hide">
                <thead>
                <tr>
                    <th style="width: 10%">score</th>
                    <th style="width: 20%">title</th>
                    <th style="width: 20%">body</th>
                    <th style="width: 10%">tags</th>
                    <th style="width: 10%">date</th>
                    <th style="width: 10%">question_id</th>
                    <th style="width: 10%">author_id</th>
                </tr>
                </thead>
                <tbody></tbody>
            </table>
        </div>
    </div>
</div>
<div><i>by <a href="https://linkedin.com/in/younes-zadi/">Younes Zadi</a></i></div>
</body>

<script>
    var apiPath = "/api"

    $.fn.serializeObject = function () {
        var o = {};
        var a = this.serializeArray();

        $.each(a, function () {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    $("#file_tab").on('click', function (e) {
        $(this).addClass("tab_active")
        $("#form_tab").removeClass("tab_active")
        $("#file_content").addClass("show").removeClass("hide")
        $("#professionals_content").addClass("hide").removeClass("show")
    })

    $("#form_tab").on('click', function (e) {
        $(this).addClass("tab_active")
        $("#file_tab").removeClass("tab_active")
        $("#professionals_content").addClass("show").removeClass("hide")
        $("#questions_content").addClass("hide").removeClass("show")
    })

    $("#file_form").on('input', function (e) {
        e.preventDefault();
        var Upload = function (file) {
            this.file = file;
        };

        Upload.prototype.getType = function() {
            return this.file.type;
        };
        Upload.prototype.getSize = function() {
            return this.file.size;
        };
        Upload.prototype.getName = function() {
            return this.file.name;
        };
        Upload.prototype.doUpload = function () {
            var that = this;
            var formData = new FormData();

            // add assoc key values, this will be posts values
            formData.append("file", this.file, this.getName());
            formData.append("upload_file", true);

            $.ajax({
                type: "POST",
                url: "/api/check_mail",
                xhr: function () {
                    var myXhr = $.ajaxSettings.xhr();
                    if (myXhr.upload) {
                        myXhr.upload.addEventListener('progress', that.progressHandling, false);
                    }
                    return myXhr;
                },
                success: function (data) {
                    console.log("ok")
                    console.log(data)

                    $("#questions_empty").addClass("hide").removeClass("show")
                    $("#questions_table").addClass("show").removeClass("hide")

                    $("#questions_table>tbody").empty();

                    $.each(data, function () {
                        $("#questions_table>tbody").append('<tr><td><b>' + this.match_score + '</b></td><td>' + this.questions_title + '</td><td>' + this.questions_body + '</td><td>' + this.tags_tag_name + '</td><td>' + this.questions_date_added + '</td><td>' + this.questions_id + '</td><td>' + this.questions_author_id + '</td></tr>')
                    })                
                },
                error: function (error) {
                    // handle error
                    console.log(error)
                },
                async: true,
                data: formData,
                cache: false,
                contentType: false,
                processData: false,
                timeout: 60000
            });
        };
        Upload.prototype.progressHandling = function (event) {
            var percent = 0;
            var position = event.loaded || event.position;
            var total = event.total;
            var progress_bar_id = "#progress-wrp";
            if (event.lengthComputable) {
                percent = Math.ceil(position / total * 100);
            }
            // update progressbars classes so it fits your code
            $(progress_bar_id + " .progress-bar").css("width", +percent + "%");
            $(progress_bar_id + " .status").text(percent + "%");
        };
        var fileInput = document.getElementById('email_file');
        var file = fileInput.files[0];
        var upload = new Upload(file);

        upload.doUpload();

        
    }).on('reset', function (e) {
        console.log("clear")
        $("#questions_table").addClass("hide").removeClass("show")
        $("#file_empty").addClass("show").removeClass("hide")
    })

    $("#professionals_form").on('input, submit', function (e) {
        e.preventDefault();
        var data = $(this).serializeObject()

        $.ajax({
            url: apiPath + '/professional',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            data: JSON.stringify(data),
            success: function (data) {
                console.log("ok")
                console.log(data)

                $("#professionals_empty").addClass("hide").removeClass("show")
                $("#professionals_table").addClass("show").removeClass("hide")

                $("#professionals_table>tbody").empty();

                $.each(data, function () {
                    $("#professionals_table>tbody").append('<tr><td><b>' + this.match_score + '</b></td><td>' + this.questions_title + '</td><td>' + this.questions_body + '</td><td>' + this.tags_tag_name + '</td><td>' + this.questions_date_added + '</td><td>' + this.questions_id + '</td><td>' + this.email_file + '</td></tr>')
                })
            }
        });
    }).on('reset', function (e) {
        console.log("clear")
        $("#professionals_table").addClass("hide").removeClass("show")
        $("#professionals_empty").addClass("show").removeClass("hide")
    })
</script>
</html>
